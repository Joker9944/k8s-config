clusterName: nyx
# renovate: datasource=docker depName=ghcr.io/siderolabs/installer
talosVersion: v1.7.6
# renovate: datasource=docker depName=ghcr.io/siderolabs/kubelet
kubernetesVersion: v1.30.2
endpoint: https://${VIP}:6443
additionalMachineCertSans:
  - ${VIP}
additionalApiServerCertSans:
  - ${VIP}
  - nyx.internal
nodes:
  - hostname: nyx-control-plane-1
    ipAddress: ${CONTROL_PLANE_1_IP}
    controlPlane: true
    installDisk: /dev/mmcblk0
    networkInterfaces:
      - interface: enxdca6325aa72d
        addresses:
          - ${CONTROL_PLANE_1_IP}/24
        routes:
          - network: 0.0.0.0/0
            gateway: ${GATEWAY}
        vip:
          ip: ${VIP}
  - hostname: nyx-worker-1
    ipAddress: ${WORKER_1_IP}
    controlPlane: false
    installDisk: /dev/vda
    networkInterfaces:
      - interface: enx00a09830128c
        addresses:
          - ${WORKER_1_IP}/24
        routes:
          - network: 0.0.0.0/0
            gateway: ${GATEWAY}
    kernelModules:
      - name: nvidia
      - name: nvidia_uvm
      - name: nvidia_drm
      - name: nvidia_modeset
    schematic:
      customization:
        systemExtensions:
          officialExtensions:
            - siderolabs/iscsi-tools
            - siderolabs/qemu-guest-agent
            - siderolabs/nonfree-kmod-nvidia
            - siderolabs/nvidia-container-toolkit
    patches:
        - |-
          machine:
            sysctls:
              net.core.bpf_jit_harden: 1
controlPlane:
  nameservers:
      - ${GATEWAY}
      - ${NAMESERVER_PRIMARY}
      - ${NAMESERVER_SECONDARY}
  schematic:
    customization:
      systemExtensions:
        officialExtensions:
          - siderolabs/iscsi-tools
worker:
  nameservers:
      - ${GATEWAY}
      - ${NAMESERVER_PRIMARY}
      - ${NAMESERVER_SECONDARY}
