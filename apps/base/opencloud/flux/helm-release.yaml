apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: opencloud
spec:
  interval: 30m
  chart:
    spec:
      chart: charts/opencloud
      interval: 30m
      sourceRef:
        kind: GitRepository
        name: opencloud

  values:

    global:

      domain:
        opencloud: cloud-eval.vonarx.online
        wopi: wopiserver.vonarx.online
        collabora: office-eval.vonarx.online

      tls:
        enable: true
        secretName: wildcard-vonarx-online-cert

      oidc:
        issuer: https://idm.vonarx.online/oauth2/openid/opencloud
        clientId: opencloud
        accountUrl: https://idm.vonarx.online/ui/profile

    keycloak:

      internal:
        enabled: false

    postgres:
      enabled: false

    collabora:
      enabled: true

      existingSecret: opencloud-collabora-credentials

    onlyoffice:
      enabled: false

    opencloud:

      storage:

        s3:
          internal:
            enabled: false

          external:
            enabled: true

            endpoint: http://garage.garage.svc.cluster.local:3900
            region: nyx
            existingSecret: opencloud-s3
            bucket: opencloud
            createBucket: false

    ingress:
      enabled: true

      annotationsPreset: "traefik"
      annotations:
        traefik.ingress.kubernetes.io/router.middlewares: opencloud-chain-country-whitelist@kubernetescrd
