apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - namespace.yaml
  - audiobookshelf/helm-release.yaml
  - jellyfin/helm-release.yaml
  - jellyseerr/helm-release.yaml
  - flaresolverr/helm-release.yaml
  - openaudible/helm-release.yaml
  - prowlarr/helm-release.yaml
  - qbittorrent/helm-release.yaml
  - radarr/helm-release.yaml
  - recyclarr/helm-release.yaml
  - sonarr/helm-release.yaml
secretGenerator:
  - name: s3-credentials-secret-values
    namespace: ${main_namespace}
    files:
      - values.yaml=../../shared/s3-credentials-values.sops.yaml
  - name: qbittorrent-secret-values
    namespace: ${main_namespace}
    files:
      - values.yaml=qbittorrent/secret-values.sops.yaml
  - name: recyclarr-secret-overlay
    namespace: ${main_namespace}
    files:
      - secrets.yaml=recyclarr/secrets.sops.yaml
configMapGenerator:
  - name: recyclarr-config-overlay
    namespace: ${main_namespace}
    files:
      - recyclarr.yaml=recyclarr/recyclarr.yaml
replacements:
  - source:
      kind: ConfigMap
      name: recyclarr-config-overlay
      namespace: ${main_namespace}
      fieldPath: metadata.name
    targets:
      - select:
          kind: Deployment
          name: recyclarr
          namespace: ${main_namespace}
        fieldPaths:
          - spec.template.spec.volumes.[name=config-overlay].configMap.name
  - source:
      kind: Secret
      name: recyclarr-secret-overlay
      namespace: ${main_namespace}
      fieldPath: metadata.name
    targets:
      - select:
          kind: Deployment
          name: recyclarr
          namespace: ${main_namespace}
        fieldPaths:
          - spec.template.spec.volumes.[name=secret-overlay].secret.secretName
configurations:
  - kustomizeconfig.yaml
